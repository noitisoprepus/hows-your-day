@page "/login"
@using Shared.DTOs.Account
@using HowsYourDayApp.Services
@inject AuthenticationService AuthenticationService
@inject DayService DayService

<PageTitle>Login</PageTitle>

<h1>Login Account Page</h1>

<input @bind="login.EmailAddress" placeholder="E-mail" />
<input @bind="login.Password" placeholder="Password" />
<button class="login-btn btn-primary" @onclick="HandleLogin">Login</button>

<br> <p>@output</p>

<button class="test-btn btn-primary" @onclick="HandleTest">Test</button>
<button class="logout-btn btn-secondary" @onclick="HandleLogout">Logout</button>

@code {
    private string output = "";
    private LoginDTO login = new LoginDTO();

    private async Task HandleLogin()
    {
        try
        {
            await AuthenticationService.LoginAsync(login);
            output = "Welcome! How's your day?";
        }
        catch (HttpRequestException e)
        {
            output = "Login failed: " + e.Message;
        }
    }

    private async Task HandleLogout()
    {
        try
        {
            await AuthenticationService.LogoutAsync();
            output = "You have been logged out.";
        }
        catch (HttpRequestException e)
        {
            output = "Logout failed: " + e.Message;
        }
    }

    private async Task HandleTest()
    {
        try
        {
            var response = await DayService.GetDaysForUserAsync();
            output = response.ToString();
        }
        catch (HttpRequestException e)
        {
            output = "Test failed: " + e.Message;
        }
    }
}
